
<!DOCTYPE html>
<html>
<head>
    <title>Full Screen Leaflet Map</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://d19vzq90twjlae.cloudfront.net/leaflet-0.7/leaflet.css" />
    <style>
        body {
            padding: 0;
            margin: 0;
        }
        html, body, #map {
            height: 100%;
            width: 100%;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <script src="https://d19vzq90twjlae.cloudfront.net/leaflet-0.7/leaflet.js">
    </script>

    <script>
        var map = L.map('map').setView([35.6892, 51.3890], 14);
        mapLink = 
            '<a href="http://www.esri.com/">Esri</a>';
        wholink = 
            'i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community';
        L.tileLayer(
            'http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: '&copy; '+mapLink+', '+wholink,
            maxZoom: 18,
            }).addTo(map);

        var ws = new WebSocket("ws://localhost:9090/");                                
        var greenIcon = L.icon({
            iconUrl: '/static/map/img/QGCLogoFull.png',

            iconSize:     [40, 40], // size of the icon
                    
            iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
                    
            popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
        });          
        
        
        var msg_counter = 0;
        var marker
        ws.onmessage = function(event) {
            if (msg_counter == 0){
                marker = L.marker([35.6892, event.data], {icon: greenIcon}).addTo(map);
            }else{
                console.log(event.data);                         
                var lat = 35.6892;
                var lng = event.data;
                var newLatLng = new L.LatLng(lat, lng);
                marker.setLatLng(newLatLng).update();
            }
            msg_counter = msg_counter + 1;
                            
        };

        ws.onclose= function(event){
            console.log('Connection closed');
        }; 

        

            


        {% comment %} 
        var map = L.map('map').setView([-41.2858, 174.78682], 14);
        mapLink = 
            '<a href="http://openstreetmap.org">OpenStreetMap</a>';
        L.tileLayer(
            'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; ' + mapLink + ' Contributors',
            maxZoom: 18,
            }).addTo(map);
            {% endcomment %}
    </script>
</body>
</html>